# ConfiguraÃ§Ã£o do servidor Nginx
server {
    listen 80 default_server;
    listen [::]:80 default_server ipv6only=on;
    server_tokens off;

    server_name localhost 127.0.0.1;
    root /var/www/app;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Powered-By "" always;
    add_header Server "" always;
    add_header Connection "" always;

    large_client_header_buffers 4 32k;
    client_max_body_size 100M;

    ssl_protocols TLSv1.2 TLSv1.3;

    index index.php home.html;

    charset utf-8;

    # ðŸ”¹ Servir arquivos estÃ¡ticos de public diretamente (deve vir ANTES do location /)
    location /public/ {
        alias /var/www/app/public/;
        expires 0;
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
        access_log off;
        # O alias jÃ¡ remove automaticamente o /public/ do caminho
        # Permite servir todos os tipos de arquivo, incluindo PDF, DOC, DOCX
        # ForÃ§a servir arquivos diretamente sem passar pelo PHP
        # Adiciona headers para PDF serem exibidos inline
        add_header Content-Disposition "inline" always;
        try_files $uri =404;
    }

    # ðŸ”¹ Ajuste para ambiente de desenvolvimento - inclui PDF e documentos
    location ~* \.(?:ico|css|js|gif|jpe?g|png|woff2?|eot|ttf|otf|svg|mp4|webm|ogg|mp3|wav|json|xml|pdf|doc|docx)$ {
        expires 0;  # Sem cache no ambiente dev
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
        access_log off;
        try_files $uri =404;
    }

    location / {
        rewrite ^/(.*)$ /index.php?route=/$1 last;
    }

    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}
